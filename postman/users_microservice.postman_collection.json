{
  "info": {
    "_postman_id": "e44b6e15-7586-4d80-baa5-8745d261123d",
    "name": "Users Microservice",
    "description": "Colección de Postman para el microservicio de usuarios. Usa variables de entorno: `base_url`, `token`, `id`. El request de Login captura automáticamente el token y lo guarda en `token`. Todas las rutas protegidas usan Authorization: Bearer {{token}}.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      { "key": "token", "value": "{{token}}", "type": "string" }
    ]
  },
  "item": [
    {
      "name": "Login (Público)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200 o 201', function () { pm.expect([200,201]).to.include(pm.response.code); });",
              "let json = {}; try { json = pm.response.json(); } catch(e) { json = {}; }",
              "if (json && json.token) { pm.environment.set('token', json.token); console.log('Token capturado en entorno:', json.token); } else { console.warn('No se encontró token en la respuesta'); }",
              "pm.test('Respuesta es JSON', function () { pm.response.to.be.json; });"
            ]
          }
        }
      ],
      "request": {
        "auth": { "type": "noauth" },
        "method": "POST",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": { "raw": "{{base_url}}/login", "host": ["{{base_url}}"], "path": ["login"] }
      }
    },
    {
      "name": "Logout (Protegido)",
      "request": {
        "method": "POST",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "url": { "raw": "{{base_url}}/logout", "host": ["{{base_url}}"], "path": ["logout"] }
      }
    },
    {
      "name": "Crear Usuario (Protegido)",
      "event": [
        {
          "listen": "test",
          "script": { "type": "text/javascript", "exec": [
            "pm.test('Status 200 o 201', function () { pm.expect([200,201]).to.include(pm.response.code); });",
            "let json = {}; try { json = pm.response.json(); } catch(e) { json = {}; }",
            "if (json && json.id) { pm.environment.set('id', json.id); }"
          ] }
        }
      ],
      "request": {
        "method": "POST",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Usuario Demo\",\n  \"email\": \"demo@example.com\",\n  \"password\": \"secret123\",\n  \"fecha_nacimiento\": \"1990-01-01\",\n  \"sexo\": \"Masculino\",\n  \"contacto_emergencia\": \"999999999\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": { "raw": "{{base_url}}/usuarios", "host": ["{{base_url}}"], "path": ["usuarios"] }
      }
    },
    {
      "name": "Listar Usuarios (Protegido)",
      "request": {
        "method": "GET",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "url": { "raw": "{{base_url}}/usuarios", "host": ["{{base_url}}"], "path": ["usuarios"] }
      }
    },
    {
      "name": "Mostrar Usuario (Protegido)",
      "request": {
        "method": "GET",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "url": { "raw": "{{base_url}}/usuarios/{{id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{id}}"] }
      }
    },
    {
      "name": "Actualizar Usuario (Protegido)",
      "request": {
        "method": "PUT",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "body": { "mode": "raw", "raw": "{\n  \"nombre\": \"Usuario Actualizado\"\n}", "options": { "raw": { "language": "json" } } },
        "url": { "raw": "{{base_url}}/usuarios/{{id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{id}}"] }
      }
    },
    {
      "name": "Eliminar Usuario (Protegido)",
      "request": {
        "method": "DELETE",
        "header": [ { "key": "Accept", "value": "application/json" } ],
        "url": { "raw": "{{base_url}}/usuarios/{{id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{id}}"] }
      }
    }
  ]
}